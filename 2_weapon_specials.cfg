#textdomain-Hailfire_Era
#WARNING! There is a glitch that happens if you place moveto events within the MAGICAL CLEAR, MAGIGAL ICE or MAGICAL FIRE weapon specials.   
#the units will get the wrong weather when they reach their villages!

   #define WEAPON_SPECIAL_MAGICAL_CLEAR
        [HF_magical_clear]
            id=HF_magical_clear
            name= _ "<span color='#E1E1E1'>magical clear</span>"
            name_inactive=_ "magical clear"
            description= _ "Removes unusual weather from the battlefield. This attack also has a 70% chance to hit regardless of the defensive ability of the unit being attacked."
            description_inactive=_ "This attack changes the unit's surroundings."
        [/HF_magical_clear] # wmlxgettext: [specials]
    [/specials] # wmlxgettext: [attack]
    [/attack]
    [chance_to_hit]
        value=70
        cumulative=no
    [/chance_to_hit]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_clear
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=dawn,Hdawn,Cdawn
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=0
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_clear
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=morning,Hmorning,Cmorning
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=1
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_clear
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=2
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_clear
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=dusk,Hdusk,Cdusk
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=3
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_clear
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=4
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_clear
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=5
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
			[filter_attack] 
				special_id=HF_magical_clear
			[/filter_attack] 
		 [set_variable]
		   name=second_unit.status.frigid
		   value=no
		 [/set_variable]
		 [set_variable]
		   name=second_unit.status.sweltry
		   value=no
		 [/set_variable]
		[if]
			[variable]
				name=second_unit.hitpoints
				greater_than=0
			[/variable]
			[and]
			[variable]
				name=$unit.hitpoints
				greater_than=0
			[/variable]
			[/and]
		[then]
			[unstore_unit]
				variable=second_unit
			[/unstore_unit]
		[/then]   
		[/if]
		 [remove_unit_overlay]
			id=$second_unit.id
			image="misc/sweltry_clear.png"
		 [/remove_unit_overlay]
		 [remove_unit_overlay]
			id=$second_unit.id
			image="misc/frigid_clear.png"
		 [/remove_unit_overlay]
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_clear
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=dawn,Hdawn,Cdawn
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=0
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_clear
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=morning,Hmorning,Cmorning
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=1
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_clear
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=2
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_clear
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=dusk,Hdusk,Cdusk
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=3
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_clear
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=4
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_clear
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {DEFAULT_SCHEDULE}
						 current_time=5
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
			[filter_second_attack] 
				special_id=HF_magical_clear
			[/filter_second_attack] 
		 [set_variable]
		   name=unit.status.frigid
		   value=no
		 [/set_variable]
		 [set_variable]
		   name=unit.status.sweltry
		   value=no
		 [/set_variable]
		 [unstore_unit]
			variable=unit
		 [/unstore_unit]
		 [remove_unit_overlay]
			id=$unit.id
			image="misc/sweltry_clear.png"
		 [/remove_unit_overlay]
		 [remove_unit_overlay]
			id=$unit.id
			image="misc/frigid_clear.png"
		 [/remove_unit_overlay]
    [/event]
    [+attack]
        [+specials]
            # wmlxgettext: [/specials]
            # wmlxgettext: [/attack]

    #enddef

    #define WEAPON_SPECIAL_MAGICAL_ICE
        [HF_magical_ice]
            id=HF_magical_ice
            name= _ "<span color='#9FEFFF'>magical ice</span>"
            name_inactive=_ "magical ice"
            description= _ "Creates cold weather, which may change how much damage is dealt in battle. This attack also has a 70% chance to hit regardless of the defensive ability of the unit being attacked."
            description_inactive=_ "This attack changes the unit's surroundings."
        [/HF_magical_ice] # wmlxgettext: [specials]
    [/specials] # wmlxgettext: [attack]
    [/attack]
	[chance_to_hit]
        value=70
        cumulative=no
    [/chance_to_hit]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_ice
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=dawn,Hdawn,Cdawn
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=0
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_ice
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=morning,Hmorning,Cmorning
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=1
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_ice
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=2
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_ice
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=dusk,Hdusk,Cdusk
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=3
					   [/time_area]
						  
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_ice
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=4
					   [/time_area]
						  			  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_ice
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}					 
						 current_time=5
					   [/time_area]
						  
		
    [/event]
	[event]
	  name=attacker hits
	  first_time_only=no
			[filter_attack]
			   special_id=HF_magical_ice
			[/filter_attack]
			 [set_variable]
			   name=second_unit.status.frigid
			   value=yes
			 [/set_variable]
			  [set_variable]
			   name=second_unit.status.sweltry
			   value=no
			 [/set_variable]
						[if]
							[variable]
								name=second_unit.hitpoints
								greater_than=0
							[/variable]
							[and]
							[variable]
								name=$unit.hitpoints
								greater_than=0
							[/variable]
							[/and]
						[then]
							[unstore_unit]
								variable=second_unit
							[/unstore_unit]
						[/then]   
						[/if]
			 [unit_overlay]
				id=$second_unit.id
				image="misc/frigid_clear.png"
			 [/unit_overlay]
			 [remove_unit_overlay]
				id=$second_unit.id
				image="misc/sweltry_clear.png"
			 [/remove_unit_overlay]
	[/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_ice
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=dawn,Hdawn,Cdawn
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=0
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_ice
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=morning,Hmorning,Cmorning
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=1
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_ice
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=2
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_ice
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=dusk,Hdusk,Cdusk
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=3
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_ice
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=4
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_ice
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {COLD_SCHEDULE}
						 current_time=5
					   [/time_area]
						  
    [/event]
	[event]
	  name=defender hits
	  first_time_only=no
			[filter_second_attack]
			   special_id=HF_magical_ice
			[/filter_second_attack]
			 [set_variable]
			   name=unit.status.frigid
			   value=yes
			 [/set_variable]
			  [set_variable]
			   name=unit.status.sweltry
			   value=no
			 [/set_variable]
			 [unstore_unit]
				variable=unit
			 [/unstore_unit]
			 [unit_overlay]
				id=$unit.id
				image="misc/frigid_clear.png"
			 [/unit_overlay]
			 [remove_unit_overlay]
				id=$unit.id
				image="misc/sweltry_clear.png"
			 [/remove_unit_overlay]
	[/event]
    [+attack]
        [+specials]
            # wmlxgettext: [/specials]
            # wmlxgettext: [/attack]
	#enddef

	#define WEAPON_SPECIAL_MAGICAL_FIRE
        [HF_magical_fire]
            id=HF_magical_fire
            name= _ "<span color='#ffd505'>magical fire</span>"
            name_inactive=_ "magical fire"
            description= _ "Creates hot weather, which may change how much damage is dealt in battle. This attack also has a 70% chance to hit regardless of the defensive ability of the unit being attacked."
            description_inactive=_ "This attack changes the unit's surroundings."
        [/HF_magical_fire] # wmlxgettext: [specials]
    [/specials] # wmlxgettext: [attack]
    [/attack]
	[chance_to_hit]
        value=70
        cumulative=no
    [/chance_to_hit]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_fire
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=dawn,Hdawn,Cdawn
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}						 
						 current_time=0
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_fire
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=morning,Hmorning,Cmorning
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=1
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_fire
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=2
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_fire
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=dusk,Hdusk,Cdusk
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=3
					   [/time_area]
						  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_fire
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=4
					   [/time_area]
						  			  
    [/event]
	[event]
        name=attacker hits
        first_time_only=no
				[filter_attack] 
					special_id=HF_magical_fire
				[/filter_attack] 
				[filter]		
					[filter_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
					[/filter_location]
				[/filter]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=5
					   [/time_area]
					  
    [/event]
	[event]
		name=attacker hits
		first_time_only=no
				[filter_attack] 
					special_id=HF_magical_fire
				[/filter_attack]   
						 [set_variable]
						   name=second_unit.status.sweltry
						   value=yes
						 [/set_variable]
						  [set_variable]
						   name=second_unit.status.frigid
						   value=no
						 [/set_variable]	
						[if]
							[variable]
								name=second_unit.hitpoints
								greater_than=0
							[/variable]
							[and]
							[variable]
								name=$unit.hitpoints
								greater_than=0
							[/variable]
							[/and]
						[then]
							[unstore_unit]
								variable=second_unit
							[/unstore_unit]
						[/then]   
						[/if]
						 [unit_overlay]
							id=$second_unit.id
							image="misc/sweltry_clear.png"
						 [/unit_overlay]
						 [remove_unit_overlay]
							id=$second_unit.id
							image="misc/frigid_clear.png"
						 [/remove_unit_overlay]
	[/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_fire
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=dawn,Hdawn,Cdawn
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=0
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_fire
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=morning,Hmorning,Cmorning
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=1
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_fire
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=2
					   [/time_area]
						    
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_fire
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=dusk,Hdusk,Cdusk
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=3
					   [/time_area]
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_fire
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=4
					   [/time_area]
						  
						  
    [/event]
	[event]
        name=defender hits
        first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_fire
				[/filter_second_attack] 
				[filter_second]		
					[filter_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
					[/filter_location]
				[/filter_second]
					   [time_area]
						 x,y=$unit.x,$unit.y
						 radius=1
						 {HOT_SCHEDULE}
						 current_time=5
					   [/time_area]
						  
    [/event]
	[event]
		name=defender hits
		first_time_only=no
				[filter_second_attack] 
					special_id=HF_magical_fire
				[/filter_second_attack]   
						 [set_variable]
						   name=unit.status.sweltry
						   value=yes
						 [/set_variable]
						  [set_variable]
						   name=unit.status.frigid
						   value=no
						 [/set_variable]
						[if]
							[variable]
								name=second_unit.hitpoints
								greater_than=0
							[/variable]
							[and]
							[variable]
								name=$unit.hitpoints
								greater_than=0
							[/variable]
							[/and]
						[then]
							[unstore_unit]
								variable=unit
							[/unstore_unit]
						[/then]   
						[/if]
						 [unit_overlay]
							id=$unit.id
							image="misc/sweltry_clear.png"
						 [/unit_overlay]
						 [remove_unit_overlay]
							id=$unit.id
							image="misc/frigid_clear.png"
						 [/remove_unit_overlay]
	[/event]
	[+attack]
		[+specials]
			# wmlxgettext: [/specials]
			# wmlxgettext: [/attack]
#enddef

#define HAILFIRE_MENU
[event]
    name=side turn
    first_time_only=no
	[set_menu_item]
		id=clear_village_hexes_1
		description= _ "Clear weather"
		[show_if]
				[have_location]
					time_of_day_id=dawn,Hdawn,Cdawn
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_clear
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {DEFAULT_SCHEDULE}
				 current_time=0
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=clear_village_hexes_2
		description= _ "Clear weather"
		[show_if]
				[have_location]
					time_of_day_id=morning,Hmorning,Cmorning
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_clear
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {DEFAULT_SCHEDULE}
				 current_time=1
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=clear_village_hexes_3
		description= _ "Clear weather"
		[show_if]
				[have_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_clear
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {DEFAULT_SCHEDULE}
				 current_time=2
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=clear_village_hexes_4
		description= _ "Clear weather"
		[show_if]
				[have_location]
					time_of_day_id=dusk,Hdusk,Cdusk
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_clear
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {DEFAULT_SCHEDULE}
				 current_time=3
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=clear_village_hexes_5
		description= _ "Clear weather"
		[show_if]
				[have_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_clear
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {DEFAULT_SCHEDULE}
				 current_time=4
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=clear_village_hexes_6
		description= _ "Clear weather"
		[show_if]
				[have_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_clear
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {DEFAULT_SCHEDULE}
				 current_time=5
			   [/time_area]
		[/command]
	[/set_menu_item]
[/event]
[event]
    name=side turn
    first_time_only=no
	[set_menu_item]
		id=cold_village_hexes_1
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=dawn,Hdawn,Cdawn
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_ice
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {COLD_SCHEDULE}
				 current_time=0
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=cold_village_hexes_2
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=morning,Hmorning,Cmorning
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_ice
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {COLD_SCHEDULE}
				 current_time=1
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=cold_village_hexes_3
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_ice
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {COLD_SCHEDULE}
				 current_time=2
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=cold_village_hexes_4
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=dusk,Hdusk,Cdusk
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_ice
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {COLD_SCHEDULE}
				 current_time=3
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=cold_village_hexes_5
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_ice
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {COLD_SCHEDULE}
				 current_time=4
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=cold_village_hexes_6
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_ice
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {COLD_SCHEDULE}
				 current_time=5
			   [/time_area]
		[/command]
	[/set_menu_item]
[/event]
[event]
    name=side turn
    first_time_only=no
	[set_menu_item]
		id=hot_village_hexes_1
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=dawn,Hdawn,Cdawn
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_fire
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {HOT_SCHEDULE}
				 current_time=0
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=hot_village_hexes_2
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=morning,Hmorning,Cmorning
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_fire
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {HOT_SCHEDULE}
				 current_time=1
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=hot_village_hexes_3
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=afternoon,Hafternoon,Cafternoon
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_fire
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {HOT_SCHEDULE}
				 current_time=2
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=hot_village_hexes_4
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=dusk,Hdusk,Cdusk
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_fire
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {HOT_SCHEDULE}
				 current_time=3
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=hot_village_hexes_5
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=first_watch,Hfirst_watch,Cfirst_watch
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_fire
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {HOT_SCHEDULE}
				 current_time=4
			   [/time_area]
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=hot_village_hexes_6
		description= _ "Change weather"
		[show_if]
				[have_location]
					time_of_day_id=second_watch,Hsecond_watch,Csecond_watch
				[/have_location]
		[/show_if]
		[filter_location]
			terrain=*^V*
			[filter]
				[has_attack]
					special_id=HF_magical_fire
				[/has_attack]
			[/filter]
		[/filter_location]
		[command]
			   [time_area]
				 x,y=$unit.x,$unit.y
				 radius=1
				 {HOT_SCHEDULE}
				 current_time=5
			   [/time_area]
		[/command]
	[/set_menu_item]
[/event]
#enddef

#define WEAPON_SPECIAL_HF_PETRIFY
    [HF_petrify]
		id=HF_petrify
        name= _ "petrify"
        female_name= _ "female^petrify"
        description=_ "This attack will petrify the opponent for one turn *not* permanently! Once petrified, enemy units can no longer enforce a zone of control, but the effect wears off on the enemy unit's next turn."
    [/HF_petrify] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker_hits
    first_time_only=no
    id=HF_petrify_attack
    [filter_attack]
        special_id=HF_petrify
    [/filter_attack]
    [store_unit]
        [filter]
            id=$second_unit.id
			[and]
				[not]
					id=$unit.id
				[/not]
			[/and]
        [/filter]
        variable=gorgon
        kill=no
    [/store_unit]
    [set_variable]
        name=gorgon.status.petrified
        value=yes
    [/set_variable]
    [set_variable]
        name=gorgon.variables.time
        value=1
    [/set_variable]
	[if]
		[variable]
			name=gorgon.hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=gorgon
			[/unstore_unit]
		[/then]   
	[/if]
	{CLEAR_VARIABLE gorgon}
[/event]
[event]
    name=defender_hits
    first_time_only=no
    id=HF_petrify_defend
	[filter_second_attack]
        special_id=HF_petrify
	[/filter_second_attack]
    [store_unit]
        [filter]
            id=$unit.id
			[and]
				[not]
					id=$second_unit.id
				[/not]
			[/and]
        [/filter]
        variable=gorgon
        kill=no
    [/store_unit]
    [set_variable]
        name=gorgon.status.petrified
        value=yes
    [/set_variable]
    [set_variable]
        name=gorgon.variables.time
        value=1
    [/set_variable]
	[if]
		[variable]
			name=gorgon.hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=gorgon
			[/unstore_unit]
		[/then]   
	[/if]
	{CLEAR_VARIABLE gorgon}
[/event]
[event]
    name=new turn
    first_time_only=no
	id=HF_petrify_countdown
    [store_unit]
        [filter]
			[filter_wml]
				[status]
					petrified=yes
				[/status]
			[/filter_wml]
        [/filter]
        kill=no
        variable=medusa_temp
    [/store_unit]
	{FOREACH medusa_temp i}
    [set_variable]
        name=medusa_temp[$i].variables.time
        sub=1
    [/set_variable]
	[if]
		[variable]
			name=medusa_temp[$i].variables.time
			equals=0
		[/variable]
		[then]
			[set_variable]
				name=medusa_temp[$i].status.petrified
				value=no
			[/set_variable]
		[/then]
	[/if]
	[if]
		[variable]
			name=medusa_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=medusa_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE medusa_temp}
[/event]
[+attack]
[+specials]
#enddef

#define WEAPON_SPECIAL_HF_BURNING
    [HF_burning]
		id=HF_burning
        name=_"burning"
        description=_ "Status inflicted by this attack does 4 fire damage for two turns with every hit."
        description_inactive=_"Status inflicted by this attack does 4 fire damage for two turns with every hit."
    [/HF_burning] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker hits
    first_time_only=no
    id=HF_burning_attack
    [filter_attack]
        special_id=HF_burning
    [/filter_attack]
    [filter_second]
        [not]
            [filter_wml]
                [status]
                    burnt=yes
                [/status]
            [/filter_wml]
        [/not]
		[and]
			[not]
				[filter_wml]
					[variables]
						burnt=yes
					[/variables]
				[/filter_wml]
			[/not]
		[/and]
    [/filter_second]
    {VARIABLE second_unit.status.burnt yes}
	{VARIABLE second_unit.variables.burnt yes}
    {VARIABLE second_unit.status.unhealable yes}
	{VARIABLE_OP second_unit.variables.burn_value add 2}
    [unstore_unit]
        variable=second_unit
		text= _ "burned"
		{COLOR_HARM}
    [/unstore_unit]
	[unit_overlay]
		id=$second_unit.id
		image="misc/ignite2.png"
	[/unit_overlay]
	[sound]
		name=torch.ogg
	[/sound]
[/event]
[event]
    name=defender hits
    first_time_only=no
    id=HF_burning_defend
    [filter_second_attack]
        special_id=HF_burning
    [/filter_second_attack]
    [filter]
        [not]
            [filter_wml]
                [status]
                    burnt=yes
                [/status]
            [/filter_wml]
        [/not]
		[and]
			[not]
				[filter_wml]
					[variables]
						burnt=yes
					[/variables]
				[/filter_wml]
			[/not]
		[/and]
    [/filter]
    {VARIABLE unit.status.burnt yes}
	{VARIABLE unit.variables.burnt yes}
    {VARIABLE unit.status.unhealable yes}
	{VARIABLE_OP unit.variables.burn_value add 2}
    [unstore_unit]
        variable=unit
		text= _ "burned"
		{COLOR_HARM}
    [/unstore_unit]
	[unit_overlay]
		id=$unit.id
		image="misc/ignite2.png"
	[/unit_overlay]
	[sound]
		name=torch.ogg
	[/sound]
[/event]
[event]
    name=new turn
    first_time_only=no
	id=HF_burning_countdown
		[harm_unit]
			[filter]
				[filter_wml]
					[variables]
						burnt=yes
					[/variables]
				[/filter_wml]
			[/filter]
			amount="3"
			damage_type=fire
			kill=no
		[/harm_unit]
		[store_unit]
		[filter]
			[filter_wml]
				[variables]
					burnt=yes
				[/variables]
			[/filter_wml]
		[/filter]
			variable=crispy_temp
		[/store_unit]
	{FOREACH crispy_temp i}
    [set_variable]
        name=crispy_temp[$i].variables.burn_value
        sub=1
    [/set_variable]
	[if]
		[variable]
			name=crispy_temp[$i].variables.burn_value
			equals=0
		[/variable]
		[then]
			[set_variable]
				name=crispy_temp[$i].status.burnt
				value=no
			[/set_variable]
			[set_variable]
				name=crispy_temp[$i].variables.burnt
				value=no
			[/set_variable]
			[set_variable]
				name=crispy_temp[$i].variables.burn_value
				value=0
			[/set_variable]
			[set_variable]
				name=crispy_temp[$i].status.unhealable
				value=no
			[/set_variable]
			[remove_unit_overlay]
				id=$crispy_temp.id
				image="misc/ignite2.png"
			[/remove_unit_overlay]
		[/then]
	[/if]
	[if]
		[variable]
			name=crispy_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=crispy_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE crispy_temp}
	[store_unit]
		[filter]
			[filter_adjacent]
				is_enemy=no
				[filter_wml]
					[abilities]
						[heals]
							affect_allies=yes
						[/heals]
					[/abilities]
				[/filter_wml]
			[/filter_adjacent]
			[or]
				[filter_location]
					terrain=*^V*
				[/filter_location]
            [/or]
		[/filter]
		variable=ash_temp
	[/store_unit]
	{FOREACH ash_temp i}
	[set_variable]
		name=ash_temp[$i].status.burnt
		value=no
	[/set_variable]
	[set_variable]
		name=ash_temp[$i].variables.burnt
		value=no
	[/set_variable]
	[set_variable]
		name=ash_temp[$i].variables.burn_value
		value=0
	[/set_variable]
	[set_variable]
		name=ash_temp[$i].status.unhealable
		value=no
	[/set_variable]
	[remove_unit_overlay]
		id=$ash_temp.id
		image="misc/ignite2.png"
	[/remove_unit_overlay]
	[if]
		[variable]
			name=ash_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=ash_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE ash_temp}
[/event]
[event]
    name=post advance
    first_time_only=no
    id=HF_burning_level
    {CLEAR_VARIABLE unit.variables.burnt}
    {CLEAR_VARIABLE unit.variables.burn_value}
    {VARIABLE unit.status.unhealable no}
	{VARIABLE unit.status.burnt no}
	[remove_unit_overlay]
		id=$unit.id
		image="misc/ignite2.png"
	[/remove_unit_overlay]
    [unstore_unit]
        variable=unit
    [/unstore_unit]
[/event]
[+attack]
    [+specials]
        # wmlxgettext: [/specials]
        # wmlxgettext: [/attack]
#enddef

#define WEAPON_SPECIAL_HF_FROSTBITE
    [HF_frostbite]
		id=HF_frostbite
        name=_"frostbite"
        description=_ "Status inflicted by this attack does 4 cold damage for two turns with every hit."
        description_inactive=_"Status inflicted by this attack does 4 cold damage for two turns with every hit."
    [/HF_frostbite] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker hits
    first_time_only=no
    id=HF_frostbite
    [filter_attack]
        special_id=HF_frostbite
    [/filter_attack]
    [filter_second]
        [not]
            [filter_wml]
                [status]
                    frostbitten=yes
                [/status]
            [/filter_wml]
        [/not]
		[and]
			[not]
				[filter_wml]
					[variables]
						frostbitten=yes
					[/variables]
				[/filter_wml]
			[/not]
		[/and]
    [/filter_second]
    {VARIABLE second_unit.status.frostbitten yes}
	{VARIABLE second_unit.variables.frostbitten yes}
    {VARIABLE second_unit.status.unhealable yes}
	{VARIABLE_OP second_unit.variables.freeze_value add 2}
    [unstore_unit]
        variable=second_unit
		text= _ "frostbitten"
		{COLOR_HARM}
    [/unstore_unit]
	[unit_overlay]
		id=$second_unit.id
		image="misc/frozen.png"
	[/unit_overlay]
	[sound]
		name=wail-sml.ogg
	[/sound]
[/event]
[event]
    name=defender hits
    first_time_only=no
    id=HF_frostbite_defender
    [filter_second_attack]
        special_id=HF_frostbite
    [/filter_second_attack]
    [filter]
        [not]
            [filter_wml]
                [status]
                    frostbitten=yes
                [/status]
            [/filter_wml]
        [/not]
		[and]
			[not]
				[filter_wml]
					[variables]
						frostbitten=yes
					[/variables]
				[/filter_wml]
			[/not]
		[/and]
    [/filter]
    {VARIABLE unit.status.frostbitten yes}
	{VARIABLE unit.variables.frostbitten yes}
    {VARIABLE unit.status.unhealable yes}
	{VARIABLE_OP unit.variables.freeze_value add 2}
    [unstore_unit]
        variable=unit
		text= _ "frostbitten"
		{COLOR_HARM}
    [/unstore_unit]
	[unit_overlay]
		id=$unit.id
		image="misc/frozen.png"
	[/unit_overlay]
	[sound]
		name=wail-sml.ogg
	[/sound]
[/event]
[event]
    name=new turn
    first_time_only=no
	id=HF_frostbite_countdown
		[harm_unit]
			[filter]
				[filter_wml]
					[variables]
						frostbitten=yes
					[/variables]
				[/filter_wml]
			[/filter]
			amount="4"
			damage_type=cold
			kill=no
		[/harm_unit]
		[store_unit]
		[filter]
			[filter_wml]
				[variables]
					frostbitten=yes
				[/variables]
			[/filter_wml]
		[/filter]
			variable=numbed_temp
		[/store_unit]
	{FOREACH numbed_temp i}
    [set_variable]
        name=numbed_temp[$i].variables.freeze_value
        sub=1
    [/set_variable]
	[if]
		[variable]
			name=numbed_temp[$i].variables.freeze_value
			equals=0
		[/variable]
		[then]
			[set_variable]
				name=numbed_temp[$i].status.frostbitten
				value=no
			[/set_variable]
			[set_variable]
				name=numbed_temp[$i].variables.frostbitten
				value=no
			[/set_variable]
			[set_variable]
				name=numbed_temp[$i].variables.freeze_value
				value=0
			[/set_variable]
			[set_variable]
				name=numbed_temp[$i].status.unhealable
				value=no
			[/set_variable]
			[remove_unit_overlay]
				id=$numbed_temp.id
				image="misc/frozen.png"
			[/remove_unit_overlay]
		[/then]
	[/if]
	[if]
		[variable]
			name=numbed_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=numbed_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE numbed_temp}
	[store_unit]
		[filter]
			[filter_adjacent]
				is_enemy=no
				[filter_wml]
					[abilities]
						[heals]
							affect_allies=yes
						[/heals]
					[/abilities]
				[/filter_wml]
			[/filter_adjacent]
			[or]
				[filter_location]
					terrain=*^V*
				[/filter_location]
            [/or]
		[/filter]
		variable=thaw_temp
	[/store_unit]
	{FOREACH thaw_temp i}
	[set_variable]
		name=thaw_temp[$i].status.frostbitten
		value=no
	[/set_variable]
	[set_variable]
		name=thaw_temp[$i].variables.frostbitten
		value=no
	[/set_variable]
	[set_variable]
		name=thaw_temp[$i].variables.freeze_value
		value=0
	[/set_variable]
	[set_variable]
		name=thaw_temp[$i].status.unhealable
		value=no
	[/set_variable]
	[remove_unit_overlay]
		id=$thaw_temp.id
		image="misc/frozen.png"
	[/remove_unit_overlay]
	[if]
		[variable]
			name=thaw_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=thaw_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE thaw_temp}
[/event]
[event]
    name=post advance
    first_time_only=no
    id=HF_frostbite_level
    {CLEAR_VARIABLE unit.variables.frostbitten}
    {CLEAR_VARIABLE unit.variables.freeze_value}
    {VARIABLE unit.status.unhealable no}
	{VARIABLE unit.status.frostbitten no}
	[remove_unit_overlay]
		id=$unit.id
		image="misc/frozen.png"
	[/remove_unit_overlay]
    [unstore_unit]
        variable=unit
    [/unstore_unit]
[/event]
[+attack]
    [+specials]
        # wmlxgettext: [/specials]
        # wmlxgettext: [/attack]
#enddef

#define WEAPON_SPECIAL_HF_PARALYSIS
    [HF_paralysis]
        id=HF_paralysis
        name= _ "paralysis"
        name_inactive= _ "paralysis"
        description= _ "this attack reduces an enemy's movement by half for two turns starting next turn."
        description_inactive= _ "this attack reduces an enemy's movement by half for two turns starting next turn."
    [/HF_paralysis] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker hits
    first_time_only=no
    id=HF_paralysis
    [filter_attack]
        special_id=HF_paralysis
    [/filter_attack]
    [filter_second]
        [not]
            [filter_wml]
                [status]
                    paralyzed=yes
                [/status]
            [/filter_wml]
        [/not]
		[and]
			[not]
				[filter_wml]
					[variables]
						paralyzed=yes
					[/variables]
				[/filter_wml]
			[/not]
		[/and]
    [/filter_second]
    {VARIABLE second_unit.status.paralyzed yes}
	{VARIABLE second_unit.variables.paralyzed yes}
	{VARIABLE_OP second_unit.variables.stumble_value add 2}
    [unstore_unit]
        variable=second_unit
		text= _ "paralyzed"
		{COLOR_HARM}
    [/unstore_unit]
	[unit_overlay]
		id=$second_unit.id
		image="misc/paralysis.png"
	[/unit_overlay]
	[sound]
		name=magic-dark.ogg
	[/sound]
[/event]
[event]
    name=defender hits
    first_time_only=no
    id=HF_paralysis_defender
    [filter_second_attack]
        special_id=HF_paralysis
    [/filter_second_attack]
    [filter]
        [not]
            [filter_wml]
                [status]
                    paralyzed=yes
                [/status]
            [/filter_wml]
        [/not]
		[and]
			[not]
				[filter_wml]
					[variables]
						paralyzed=yes
					[/variables]
				[/filter_wml]
			[/not]
		[/and]
    [/filter]
    {VARIABLE unit.status.paralyzed yes}
	{VARIABLE unit.variables.paralyzed yes}
	{VARIABLE_OP unit.variables.stumble_value add 2}
    [unstore_unit]
        variable=unit
		text= _ "paralyzed"
		{COLOR_HARM}
    [/unstore_unit]
	[unit_overlay]
		id=$unit.id
		image="misc/paralysis.png"
	[/unit_overlay]
	[sound]
		name=magic-dark.ogg
	[/sound]
[/event]
[event]
    name=new turn
    first_time_only=no
	id=HF_paralysis_countdown
		[store_unit]
		[filter]
			[filter_wml]
				[variables]
					paralyzed=yes
				[/variables]
			[/filter_wml]
		[/filter]
			variable=shocked_temp
		[/store_unit]
	{FOREACH shocked_temp i}
	{VARIABLE shocked_temp[$i].moves $shocked_temp[$i].max_moves}
	{VARIABLE_OP shocked_temp[$i].moves multiply 0.5}
    [set_variable]
        name=shocked_temp[$i].variables.stumble_value
        sub=1
    [/set_variable]
	[if]
		[variable]
			name=shocked_temp[$i].variables.stumble_value
			equals=0
		[/variable]
		[then]
			[set_variable]
				name=shocked_temp[$i].status.paralyzed
				value=no
			[/set_variable]
			[set_variable]
				name=shocked_temp[$i].variables.paralyzed
				value=no
			[/set_variable]
			[set_variable]
				name=shocked_temp[$i].variables.stumble_value
				value=0
			[/set_variable]
			[remove_unit_overlay]
				id=$shocked_temp.id
				image="misc/paralysis.png"
			[/remove_unit_overlay]
		[/then]
	[/if]
	[if]
		[variable]
			name=shocked_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=shocked_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE shocked_temp}
	[store_unit]
		[filter]
			[filter_adjacent]
				is_enemy=no
				[filter_wml]
					[abilities]
						[heals]
							affect_allies=yes
						[/heals]
					[/abilities]
				[/filter_wml]
			[/filter_adjacent]
			[or]
				[filter_location]
					terrain=*^V*
				[/filter_location]
            [/or]
		[/filter]
		variable=limber_temp
	[/store_unit]
	{FOREACH limber_temp i}
	[set_variable]
		name=limber_temp[$i].status.paralyzed
		value=no
	[/set_variable]
	[set_variable]
		name=limber_temp[$i].variables.paralyzed
		value=no
	[/set_variable]
	[set_variable]
		name=limber_temp[$i].variables.stumble_value
		value=0
	[/set_variable]
	[remove_unit_overlay]
		id=$limber_temp.id
		image="misc/paralysis.png"
	[/remove_unit_overlay]
	[if]
		[variable]
			name=limber_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=limber_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE limber_temp}
[/event]
[event]
    name=post advance
    first_time_only=no
    id=HF_paralysis_level
    {CLEAR_VARIABLE unit.variables.paralyzed}
    {CLEAR_VARIABLE unit.variables.stumble_value}
    {VARIABLE unit.status.unhealable no}
	{VARIABLE unit.status.paralyzed no}
	[remove_unit_overlay]
		id=$unit.id
		image="misc/paralysis.png"
	[/remove_unit_overlay]
    [unstore_unit]
        variable=unit
    [/unstore_unit]
[/event]
[+attack]
[+specials]
#enddef

#define WEAPON_SPECIAL_HF_DIZZY
    [HF_dizzy]
		id=HF_dizzy
        name=_"dizzy"
        description=_ "Status inflicted by this attacked does 8 impact damage per turn. The status wears off after three turns."
        description_inactive=_"Status inflicted by this attacked does 8 impact damage per turn. The status wears off after three turns."
    [/HF_dizzy] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker_hits
    first_time_only=no
    id=HF_dizzy_attack
    [filter_attack]
        special_id=HF_dizzy
    [/filter_attack]
    [store_unit]
        [filter]
            id=$second_unit.id
			[and]
				[not]
					id=$unit.id
				[/not]
			[/and]
        [/filter]
        variable=blunted
        kill=no
    [/store_unit]
    [set_variable]
        name=blunted.status.dizzied
        value=yes
    [/set_variable]
    [set_variable]
        name=blunted.variables.time
        value=3
    [/set_variable]
	[if]
		[variable]
			name=blunted.hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=blunted
			[/unstore_unit]
		[/then]   
	[/if]
	[unit_overlay]
		id=$second_unit.id
		image="misc/dizzy.png"
	[/unit_overlay]
	{CLEAR_VARIABLE blunted}
[/event]
[event]
    name=defender_hits
    first_time_only=no
    id=HF_dizzy_defend
    [filter_second_attack]
        special_id=HF_dizzy
    [/filter_second_attack]
    [store_unit]
        [filter]
            id=$unit.id
			[and]
				[not]
					id=$second_unit.id
				[/not]
			[/and]
        [/filter]
        variable=blunted
        kill=no
    [/store_unit]
    [set_variable]
        name=blunted.status.dizzied
        value=yes
    [/set_variable]
    [set_variable]
        name=blunted.variables.time
        value=3
    [/set_variable]
	[if]
		[variable]
			name=blunted.hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=blunted
			[/unstore_unit]
		[/then]   
	[/if]
	[unit_overlay]
		id=$unit.id
		image="misc/dizzy.png"
	[/unit_overlay]
	{CLEAR_VARIABLE blunted}
[/event]
[event]
    name=new turn
    first_time_only=no
	id=HF_dizzy_countdown
     [harm_unit]
        [filter]
			[filter_wml]
				[status]
					dizzy=yes
				[/status]
			[/filter_wml]
        [/filter]
		amount=8
		damage_type=impact
		fire_event=yes
		experience=yes
		animate=yes
      [/harm_unit] 
    [store_unit]
        [filter]
			[filter_wml]
				[status]
					dizzy=yes
				[/status]
			[/filter_wml]
        [/filter]
        kill=no
        variable=concussion_temp
    [/store_unit]
	{FOREACH concussion_temp i}   
    [set_variable]
        name=concussion_temp[$i].variables.time
        sub=1
    [/set_variable]
	[if]
		[variable]
			name=concussion_temp[$i].variables.time
			equals=0
		[/variable]
		[then]
			[set_variable]
				name=concussion_temp[$i].status.dizzied
				value=no
			[/set_variable]
			[remove_unit_overlay]
				id=$unit.id
				image="misc/dizzy.png"
			[/remove_unit_overlay]
		[/then]
	[/if]
	[if]
		[variable]
			name=concussion_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=concussion_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE concussion_temp}
[/event]
[+attack]
[+specials]
#enddef

#define WEAPON_SPECIAL_HF_BLEEDER
    [HF_bleeder]
		id=HF_bleeder
        name=_"bleeding"
        description=_ "Status inflicted by this attacked does 4 blade damage per turn. The status wears off after three turns."
        description_inactive=_"Status inflicted by this attacked does 4 blade damage per turn. The status wears off after three turns."
    [/HF_bleeder] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker_hits
    first_time_only=no
    id=HF_bleeder_attack
    [filter_attack]
        special_id=HF_bleeder
    [/filter_attack]
    [store_unit]
        [filter]
            id=$second_unit.id
			[and]
				[not]
					id=$unit.id
				[/not]
			[/and]
        [/filter]
        variable=scarred
        kill=no
    [/store_unit]
    [set_variable]
        name=scarred.status.bleeding
        value=yes
    [/set_variable]
    [set_variable]
        name=scarred.variables.time
        value=3
    [/set_variable]
	[if]
		[variable]
			name=scarred.hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=scarred
			[/unstore_unit]
		[/then]   
	[/if]
	[unit_overlay]
		id=$second_unit.id
		image="misc/bleeding.png"
	[/unit_overlay]
	{CLEAR_VARIABLE scarred}
[/event]
[event]
    name=defender_hits
    first_time_only=no
    id=HF_bleeder_defend
    [filter_second_attack]
        special_id=HF_bleeder
    [/filter_second_attack]
    [store_unit]
        [filter]
            id=$unit.id
			[and]
				[not]
					id=$second_unit.id
				[/not]
			[/and]
        [/filter]
        variable=scarred
        kill=no
    [/store_unit]
    [set_variable]
        name=scarred.status.bleeding
        value=yes
    [/set_variable]
    [set_variable]
        name=scarred.variables.time
        value=3
    [/set_variable]
	[if]
		[variable]
			name=scarred.hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=scarred
			[/unstore_unit]
		[/then]   
	[/if]
	[unit_overlay]
		id=$unit.id
		image="misc/bleeding.png"
	[/unit_overlay]
	{CLEAR_VARIABLE scarred}
[/event]
[event]
    name=new turn
    first_time_only=no
	id=HF_bleeder_countdown
     [harm_unit]
        [filter]
			[filter_wml]
				[status]
					bleeding=yes
				[/status]
			[/filter_wml]
        [/filter]
		amount=4
		damage_type=blade
		fire_event=yes
		experience=yes
		animate=yes
      [/harm_unit] 
    [store_unit]
        [filter]
			[filter_wml]
				[status]
					bleeding=yes
				[/status]
			[/filter_wml]
        [/filter]
        kill=no
        variable=laceration_temp
    [/store_unit]
	{FOREACH laceration_temp i}   
    [set_variable]
        name=laceration_temp[$i].variables.time
        sub=1
    [/set_variable]
	[if]
		[variable]
			name=laceration_temp[$i].variables.time
			equals=0
		[/variable]
		[then]
			[set_variable]
				name=laceration_temp[$i].status.bleeding
				value=no
			[/set_variable]
			[remove_unit_overlay]
				id=$unit.id
				image="misc/bleeding.png"
			[/remove_unit_overlay]
		[/then]
	[/if]
	[if]
		[variable]
			name=laceration_temp[$i].hitpoints
			greater_than=0
		[/variable]
		[then]
			[unstore_unit]
				variable=laceration_temp[$i]
			[/unstore_unit]
		[/then]   
	[/if]
	{NEXT i}
    {CLEAR_VARIABLE laceration_temp}
[/event]
[+attack]
[+specials]
#enddef

#define WEAPON_SPECIAL_PLOWING
    [knockback]
        id=HF_plowing
        name= _ "plowing"
		name_inactive=_ "plowing"
        description=_ "During attack or defense, even one successful hit will push the opponent one hex away. The enemy unit cannot be pushed into occupied hexes, out of village hexes or onto any hex that foe could not travel to. This attack does 10 damage to the user with each hit. Must be adjacent to at least one ally."
		description_inactive=_ "This attack may push back the enemy."
    [/knockback] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker hits
    first_time_only=no
    id=HF_plowing_attack
	[filter]
		type=HF_Farmer_Halfling,HF_Farmer_Stouthearted,HF_Farmer_Expeller
		[and]
			[filter_attack]
				special_id=HF_plowing
			[/filter_attack]
		[/and]
		[and]
			[filter_self]
				[filter_adjacent]
					is_enemy=no
				[/filter_adjacent]
			[/filter_self]
		[/and]
	[/filter]
	[filter_second]
		[not]
			[filter_location]
				terrain=*^V*
			[/filter_location]
		[/not]
	[/filter_second]
	 [harm_unit]
        [filter]
			x,y=$x1,$y1
        [/filter]
      animate=yes
      experience=yes
      kill=yes
      amount=10
    [/harm_unit]
		[if]
			[variable]
				name=second_unit.hitpoints
				greater_than=0
			[/variable]

			[then]
				[if]
					[have_unit]
						x,y=$x1,$y1
						[filter_adjacent]
							x,y=$x2,$y2
							adjacent=n
						[/filter_adjacent]
					[/have_unit]
					[then]
						{VARIABLE knockback_direction n}
					[/then]
					[else]
						[if]
							[have_unit]
								x,y=$x1,$y1
								[filter_adjacent]
									x,y=$x2,$y2
									adjacent=ne
								[/filter_adjacent]
							[/have_unit]
							[then]
								{VARIABLE knockback_direction ne}
							[/then]
							[else]
								[if]
									[have_unit]
										x,y=$x1,$y1
										[filter_adjacent]
											x,y=$x2,$y2
											adjacent=se
										[/filter_adjacent]
									[/have_unit]
									[then]
										{VARIABLE knockback_direction se}
									[/then]
									[else]
										[if]
											[have_unit]
												x,y=$x1,$y1
												[filter_adjacent]
													x,y=$x2,$y2
													adjacent=s
												[/filter_adjacent]
											[/have_unit]
											[then]
												{VARIABLE knockback_direction s}
											[/then]
											[else]
												[if]
													[have_unit]
														x,y=$x1,$y1
														[filter_adjacent]
															x,y=$x2,$y2
															adjacent=sw
														[/filter_adjacent]
													[/have_unit]
													[then]
														{VARIABLE knockback_direction sw}
													[/then]
													[else]
														[if]
															[have_unit]
																x,y=$x1,$y1
																[filter_adjacent]
																	x,y=$x2,$y2
																	adjacent=nw
																[/filter_adjacent]
															[/have_unit]
															[then]
																{VARIABLE knockback_direction nw}
															[/then]
														[/if]
													[/else]
												[/if]
											[/else]
										[/if]
									[/else]
								[/if]
							[/else]
						[/if]
					[/else]
				[/if]
            [store_locations]
                [not]
                    [filter]
                    [/filter]
                [/not]
                #terrain=!,Q*,Q*^*,*^Q*,Mv,X*,X*^*,*^X*,_*^*,*^_*
                [filter_adjacent_location]
                    x,y=$x2,$y2
                    adjacent=-$knockback_direction
                [/filter_adjacent_location]

                variable=knockback_target_hex
            [/store_locations]
            [lua]
                code=<<
local u = wesnoth.get_unit(wesnoth.get_variable("second_unit.x"),wesnoth.get_variable("second_unit.y"))
local t = wesnoth.get_variable("knockback_target_hex[0].terrain")
if t then
	local move_cost = wesnoth.unit_movement_cost(u, t)
	if(move_cost>19) then
		wesnoth.set_variable("knockback_target_hex")
	end
end
				>>
            [/lua]

            [if]
                [variable]
                    name=knockback_target_hex.length
                    greater_than=0
                [/variable]

                [then]
                    [teleport]
                        [filter]
                            x,y=$x2,$y2
                        [/filter]

                        x,y=$knockback_target_hex.x,$knockback_target_hex.y
                        ignore_passability=yes
                    [/teleport]

                    [if]
                        [have_unit]
                            x,y=$knockback_target_hex.x,$knockback_target_hex.y
                        [/have_unit]

                        [then]
                            [sound]
                                name=fist.ogg
                            [/sound]

                            # the knockbacked unit doesn't seem to receive experience by default,
                            # so we need to add it manually
                            [store_unit]
                                [filter]
                                    x,y=$knockback_target_hex.x,$knockback_target_hex.y
                                [/filter]

                                kill=yes
                                variable=knockbacked
                            [/store_unit]

                            {VARIABLE_OP knockbacked.experience add $unit.level}

                            [unstore_unit]
                                variable=knockbacked
                                text= _ "knockback"
                                {COLOR_HARM}
                                advance=true
                            [/unstore_unit]

                            {CLEAR_VARIABLE knockbacked}
                        [/then]
                    [/if]
                [/then]
            [/if]

            {CLEAR_VARIABLE knockback_direction,knockback_target_hex}
        [/then]
    [/if]
[/event]
[event]
    name=defender hits
    first_time_only=no
    id=HF_plowing_defense
    [filter]
        [not]
            [filter_location]
                terrain=*^V*
            [/filter_location]
        [/not]
    [/filter]
	[filter_second]
		type=HF_Farmer_Halfling,HF_Farmer_Stouthearted,HF_Farmer_Expeller
		[and]
			[filter_attack]
				special_id=HF_plowing
			[/filter_attack]
		[/and]
		[and]
			[filter_self]
				[filter_adjacent]
					is_enemy=no
				[/filter_adjacent]
			[/filter_self]
		[/and]
	[/filter_second]
	 [harm_unit]
        [filter]
			x,y=$x2,$y2
        [/filter]
      animate=yes
      experience=yes
      kill=yes
      amount=10
    [/harm_unit]
    [if]
        [variable]
            name=unit.hitpoints
            greater_than=0
        [/variable]

        [then]
            [if]
                [have_unit]
					x,y=$x2,$y2
					[filter_adjacent]
						x,y=$x1,$y1
                        adjacent=n
                    [/filter_adjacent]
                [/have_unit]
                [then]
                    {VARIABLE knockback_direction n}
                [/then]
                [else]
                    [if]
                        [have_unit]
							x,y=$x2,$y2
							[filter_adjacent]
								x,y=$x1,$y1
                                adjacent=ne
                            [/filter_adjacent]
                        [/have_unit]
                        [then]
                            {VARIABLE knockback_direction ne}
                        [/then]
                        [else]
                            [if]
                                [have_unit]
                                    x,y=$x2,$y2
                                    [filter_adjacent]
                                        x,y=$x1,$y1
                                        adjacent=se
                                    [/filter_adjacent]
                                [/have_unit]
                                [then]
                                    {VARIABLE knockback_direction se}
                                [/then]
                                [else]
                                    [if]
                                        [have_unit]
											x,y=$x2,$y2
											[filter_adjacent]
												x,y=$x1,$y1
                                                adjacent=s
                                            [/filter_adjacent]
                                        [/have_unit]
                                        [then]
                                            {VARIABLE knockback_direction s}
                                        [/then]
                                        [else]
                                            [if]
                                                [have_unit]
													x,y=$x2,$y2
													[filter_adjacent]
														x,y=$x1,$y1
                                                        adjacent=sw
                                                    [/filter_adjacent]
                                                [/have_unit]
                                                [then]
                                                    {VARIABLE knockback_direction sw}
                                                [/then]
                                                [else]
                                                    [if]
                                                        [have_unit]
															x,y=$x2,$y2
															[filter_adjacent]
																x,y=$x1,$y1
                                                                adjacent=nw
                                                            [/filter_adjacent]
                                                        [/have_unit]
                                                        [then]
                                                            {VARIABLE knockback_direction nw}
                                                        [/then]
                                                    [/if]
                                                [/else]
                                            [/if]
                                        [/else]
                                    [/if]
                                [/else]
                            [/if]
                        [/else]
                    [/if]
                [/else]
            [/if]

            [store_locations]
                [not]
                    [filter]
                    [/filter]
                [/not]
                #terrain=!,Q*,Q*^*,*^Q*,Mv,X*,X*^*,*^X*,_*^*,*^_*
                [filter_adjacent_location]
                    x,y=$x1,$y1
                    adjacent=-$knockback_direction
                [/filter_adjacent_location]

                variable=knockback_target_hex
            [/store_locations]
            [lua]
                code=<<
local u = wesnoth.get_unit(wesnoth.get_variable("unit.x"),wesnoth.get_variable("unit.y"))
local t = wesnoth.get_variable("knockback_target_hex[0].terrain")
if t then
	local move_cost = wesnoth.unit_movement_cost(u, t)
	if(move_cost>19) then
		wesnoth.set_variable("knockback_target_hex")
	end
end
				>>
            [/lua]

            [if]
                [variable]
                    name=knockback_target_hex.length
                    greater_than=0
                [/variable]

                [then]
                    [teleport]
                        [filter]
                            x,y=$x1,$y1
                        [/filter]

                        x,y=$knockback_target_hex.x,$knockback_target_hex.y
                        ignore_passability=yes
                    [/teleport]

                    [if]
                        [have_unit]
                            x,y=$knockback_target_hex.x,$knockback_target_hex.y
                        [/have_unit]

                        [then]
                            [sound]
                                name=fist.ogg
                            [/sound]

                            # the knockbacked unit doesn't seem to receive experience by default,
                            # so we need to add it manually
                            [store_unit]
                                [filter]
                                    x,y=$knockback_target_hex.x,$knockback_target_hex.y
                                [/filter]

                                kill=yes
                                variable=knockbacked
                            [/store_unit]

                            {VARIABLE_OP knockbacked.experience add $unit.level}

                            [unstore_unit]
                                variable=knockbacked
                                text= _ "knockback"
                                {COLOR_HARM}
                                advance=true
                            [/unstore_unit]

                            {CLEAR_VARIABLE knockbacked}
                        [/then]
                    [/if]
                [/then]
            [/if]

            {CLEAR_VARIABLE knockback_direction,knockback_target_hex}
        [/then]
    [/if]
[/event]
[+attack]
    [+specials]
        # wmlxgettext: [/specials]
        # wmlxgettext: [/attack]
#enddef

#define WEAPON_SPECIAL_JOUST
    [HF_jousting]
		id=HF_jousting
        name=_"jousting"
        description=_ "Damage increases based on the amount of spaces the unit moved before attacking."
        description_inactive=_"Damage increases based on the amount of spaces the unit moved before attacking."
    [/HF_jousting] # wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker_hits
    first_time_only=no
    id=HF_jousting_attack
    [filter_attack]
        special_id=HF_joust
    [/filter_attack]
     [harm_unit]
        [filter]
       x,y=$x2,$y2
        [/filter]
      animate=yes
      experience=yes
      kill=yes
      amount=$(($unit.moves)*2/($unit.max_moves))
    [/harm_unit]
[/event]
[event]
    name=defender_hits
    first_time_only=no
    id=HF_jousting_defend
    [filter_second_attack]
        special_id=HF_joust
    [/filter_second_attack]
     [harm_unit]
        [filter]
       x,y=$x1,$y1
        [/filter]
      animate=yes
      experience=yes
      kill=yes
      amount=$(($unit.moves)*2/($unit.max_moves))
    [/harm_unit]
[/event]
[+attack]
[+specials]
#enddef

#define WEAPON_SPECIAL_TWILIGHT
    [damage]
        id=HF_twilight
        name= _ "twilight"
        description= _ "The damage of this attack doubles during dawn and dusk but becomes half as accurate in hot weather tiles and cold weather tiles."
		affect=opponent
        multiply=2
        [filter_self]
            [filter_location]
                time_of_day_id=dawn,Hdawn,Cdawn,dusk,Hdusk,Cdusk
            [/filter_location]
        [/filter_self]
    [/damage]
	[chance_to_hit]
		id=HF_twilight
		affect=self
        sub=50
        cumulative=yes
        [filter_self]
            [filter_location]
                time_of_day_id=Cmorning,Cafternoon,Hmorning,Hafternoon,Cfirst_watch,Csecond_watch,Hfirst_watch,Hsecond_watch
            [/filter_location]
        [/filter_self]
    [/chance_to_hit]
#enddef

#define WEAPON_SPECIAL_EXOTIC
    [damage]
        id=HF_exotic
        name= _ "exotic"
        description= _ "This attack does 50% more damage in unusually hot or cold weather, but halves damage against other rustic units."
		affect=opponent
        multiply=1.5
		[filter_self]
            [filter_location]
                time_of_day_id=Cdawn,Cmorning,Cafternoon,Cdusk,Cfirst_watch,Csecond_watch,Hdawn,Hmorning,Hafternoon,Hdusk,Hfirst_watch,Hsecond_watch
            [/filter_location]
        [/filter_self]
    [/damage]
	[damage]
		id=HF_exotic
		affect=opponent
		multiply=0.5
		[filter_opponent]
			ability=HF_rustic
		[/filter_opponent]
	[/damage]
#enddef
	
#define WEAPON_SPECIAL_PREJUDICE
    [damage]
        id=HF_prejudice
        name= _ "prejudice"
        description= _ "This attack does 50% more damage to arctic and tropic units, but only half damage to other rustic units."
		affect=opponent
        multiply=1.5
        [filter_opponent]
            ability=HF_tropic,HF_arctic
        [/filter_opponent]
    [/damage]
	[damage]
		id=HF_prejudice
		affect=opponent
        multiply=0.5
        [filter_opponent]
            ability=HF_rustic
        [/filter_opponent]
    [/damage]
#enddef

#define WEAPON_SPECIAL_DESPERATION
    [attacks]
        id=HF_desperation
        name= _ "desperation"
        description= _ "This attack doubles the amount of strikes in unusually hot or cold weather, but halves damage against other rustic units."
        multiply=2
		[filter_self]
            [filter_location]
                time_of_day_id=Cdawn,Cmorning,Cafternoon,Cdusk,Cfirst_watch,Csecond_watch,Hdawn,Hmorning,Hafternoon,Hdusk,Hfirst_watch,Hsecond_watch
            [/filter_location]
        [/filter_self]
    [/attacks]
	[damage]
		id=HF_desperation
		affect=opponent
		multiply=0.5
		[filter_opponent]
			ability=HF_rustic
		[/filter_opponent]
	[/damage]
#enddef

#define WEAPON_SPECIAL_SEAWORTH
    [attacks]
        id=HF_seaworth
        name= _ "seaworth"
        description= _ "This attack doubles the amount of strikes while the unit is submerged."
        multiply=2
		[filter_self]
            [filter_location]
                terrain=Wo*^*
            [/filter_location]
        [/filter_self]
    [/attacks]
#enddef

#define WEAPON_SPECIAL_TRAPPER
	[slow]
		id=HF_trapper
		name= _ "trapper"
		description= _ "When adjacent to at least one friendly unit this attack has the "slow" ability."
		apply_to=self
		[filter_self]
			[filter_adjacent]
				is_enemy=no
			[/filter_adjacent]
		[/filter_self]
	[/slow]
#enddef

#define WEAPON_SPECIAL_VIGILANCE
	[firststrike]
        id=HF_vigiliance
        name= _ "vigilance"
        description= _ "When adjacent to at least one friendly unit this attack has the "firststrike" ability."
		[filter_self]
			[filter_adjacent]
				is_enemy=no
			[/filter_adjacent]
		[/filter_self]
    [/firststrike]
#enddef

#define WEAPON_SPECIAL_SURVERYOR
	[chance_to_hit]
        id=HF_surveyor
        name= _ "surveyor"
        description= _ "This attack has at least a 70% chance to hit when used offensively next to at least one friendly unit."
        value=70
        cumulative=no
		[filter_self]
			[filter_adjacent]
				is_enemy=no
			[/filter_adjacent]
		[/filter_self]
    [/chance_to_hit]
#enddef

#define WEAPON_SPECIAL_CHECKMATE
    [attacks]
        id=HF_checkmate
        name= _ "checkmate"
        description= _ "This attack gets one extra hit when adjacent to two or more allies. On the other hand this attack loses one hit while adjacent to three or more enemies."
        add=1
        apply_to=self
		[filter_self]
			[filter_adjacent]
				is_enemy=no
				count=2,3,4,5
			[/filter_adjacent]
		[/filter_self]
    [/attacks]
	[attacks]
		id=HF_checkmate
        sub=1
        apply_to=self
		[filter_self]
			[filter_adjacent]
				is_enemy=yes
				count=3,4,5,6
			[/filter_adjacent]
		[/filter_self]
    [/attacks]
#enddef

#define WEAPON_SPECIAL_HF_PLAGUE
    [plague]
        id=plague
        name= _ "plague"
        description= _ "When a unit is killed by a Plague attack, that unit is replaced with a unit on the same side as the unit with the Plague attack. This doesn’t work on Undead or units in villages."
        type=HF_Corpse_Walking
    [/plague]
#enddef